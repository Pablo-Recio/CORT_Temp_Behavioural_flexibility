---
docx: 
bibliography: "./bib/refs.bib"
csl: "./bib/biology-letters.csl"
reference-doc: "./bib/tmpl.docx"
execute:
  echo: false
  error: false
  cache: false
  warning: false
link-citations: true
crossref:  
  fig-title: Fig    # (default is "Figure")
  title-delim: —     # (default is ":")
  fig-prefix: Fig.   # (default is "Figure")
  tbl-prefix: Table  # (default is "Table")
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: setup
pacman::p_load(tidyverse, flextable, emmeans, DHARMa, brms, here, ggplot2, lme4, zoo, lmerTest, broom, tidybayes, ggh4x)
```

## Introduction
Behavioural flexibility, i.e. the ability to adjust the behaviour adaptively in response to internal or external changes by problem-solving, innovation, or alterations in one behaviour in favour of another [@brown2010behavioral], is considered crucial for invasion success [@wright2010behavioral; @chapple2012can; @szabo2020can]. In general, species with higher behavioural flexibility are more likely to survive and establish in new habitats, as behaving flexibly enhances their capacity to exploit new resources and face new challenges [@wright2010behavioral; @chapple2012can; @szabo2020can]. For instance, when closely related species of birds were compared, successful invaders showed a higher frequency of foraging innovations [@sol2000behavioural]. According to the adaptive flexibility hypothesis, behavioural flexibility can be more relevant during introduction, establishment, and spread of the population [@wright2010behavioral; @chapple2012can; @szabo2020can], stages that, nonetheless, can involve more than one generation. If behavioural flexibility is adaptive in these different stages, both this trait and the underlining mechanisms are expected to persist through generations in succesful invaders. For example, in mammals, birds, reptiles and amphibians, relative brain size is a good predictor of behavioural flexibility and invasive success [@sol2000behavioural; @sol2002behavioural; @sol2008brain; @amiel_effects_2017]. Since the brain is especially sensitive to environmental changes during the early stages of development [@zhu_prenatal_2004] it is possible that the new prenatal environment faced by establishing populations can affect the behavioural flexibility of the new generations [see @jonson1976effect; @lui2017chronic], with a consequent impact on invasion success. Therefore, we consider important to investigate the effect of developmental conditions on behavioural flexibility and if it can predict the success of invasive species.  
In this scenario, we consider prenatal Glucocorticoids (GCs) and thermal environment to be salient factors in the study of behavioural flexibility within the context of invasion biology for several reasons. First, GCs are the main group of hormones related to animals’ response towards alterations in homeostasis [@sapolsky_how_2000] that may become relevant when facing new environments and their new thermal conditions [@Crino_2023]. Secondly, there is evidence that both developmental GCs and thermal environment can impact cognition in different taxa [@jonson1976effect; @zhu_prenatal_2004; @amiel_hotter_2012; @lui2017chronic]. For instance, young Sprague-Dawley rats treated with Corticosterone (CORT) - the principal GC in rodents, birds, and reptiles [@Crino_2023] - performed worse than controls in a reversal learning task [@lui2017chronic], while exposure of pregnant guinea pigs to higher temperatures resulted in significant impariments with offspring behavoural flexibility [@jonson1976effect]. In addition, the cognitive effects of both factors are triggered by similar physiological mechanisms intertwined with brain development [@jonson1976effect; @coomber_independent_1997; @zhu_prenatal_2004; @amiel_effects_2017], an aspect that is considered essential in succesful invaders [@sol2000behavioural; @sol2002behavioural; @sol2008brain; @amiel_effects_2017].  
Here, we studied the interactive contribution of prenatal temperature and CORT on behavioural flexibility in two species that exhibit distinct outcomes in their roles as invasive species, the delicate skink (_Lampropholis delicata_) and the common garden skink (_L. guichenoti_). These two species are closely related and share similar life history traits [@chapple_know_2011; @chapple_biology_2014], but only _L. delicata_ has been succesful in colonising different areas around the globe [@baker1979rainbow; @chapple2013divergent; @chapple2015deliinvLHI]. Some studies have shown differences in personality traits between these two species that can be related to higher behavioural flexibility in _L. delicata_, and are likely key for its invassive success [@chapple_know_2011; @chapple2012can; @bezzina2014does]. However, differences between species in behavioural flexibility and how this trait is affected by the prenatal environment remains unknown. To investigate these effects, we first manipulated CORT levels and incubation temperature in eggs from both species, and then subjected the juveniles to a reversal learning task as a measure of behavioural flexibility [@brown2010behavioral; @szabo2020can]. We predicted that _L. delicata_ would, on average, perform more proficiently in the task that _L. guichenoti_. We also anticipated prenatal CORT and temperature to affect the behavioural flexibility of both species, and that _L. guichenoti_ would be more impacted by the prenatal environment than _L. delicata_. Regarding the directionality of the treatments, high prenatal temperatures are considered to improve performance in cognitive tasks in ectotherms [@amiel_hotter_2012; @amiel_egg_2014; @clark_colour_2014], so we expected those incubated at higher temperatures to perform better in the reversal task. On the other hand, we expected that prenatal CORT would impair the performance of the lizards in the task, as it has been shown in other species [@lemaire_prenatal_2000; @zhu_prenatal_2004; @lui2017chronic]. Finally, we expected an interaction between both treatments, with high temperatures mitigating the negative effects of prenatal CORT on the performance of the lizards in the task.  

## Methods  

#### Experimental design
We employed juveniles of both species, _L. delicata_ and _L. guichenoti_ that came from a breeding colony kept in the lab (details of breeding colony and husbandry in Supplementary Material). To see the effect of prenatal CORT and temperature, eggs were topically supplied with 5µL of CORT dissolved in 70% Ethanol and 30% DMSO ('CORT' treatment) or the same volume of the vehicle ('Control'), and were then incubated at different temperatures ('Cold' -- 23ºC ± 3ºC or 'Hot' -- 30ºC ± 3ºC) until hatching.  
To estimate behavioural flexibility, we examined lizards' performance in a reversal learning task using colour as the main conditioned stimulus and food (frozen small *A. domestica*) as a reward (see @fig-Methods). The learning test was divided in three main phases: there was first a habituation phase where lizards had to learn to eat from white 3D-printed PLA ramps (9 L x 4 W x 5 H cm); then a second phase where lizards had to associate the attainability of food with one colour; and finally the reversal task where the colour associated with the attainable food was changed (@fig-Methods B). In associative and reversal tasks we used  using three different ramps that were identical in size and shape to the ones for the habituation phase. The colours of the ramps were green, red, and blue, as previous studies demonstrate that squamates can discriminate between these colours [@Baden_Osorio_2019_Vert_vision]. To control for potential colour biases, we assigned one group of lizards to associate the blue ramp with the attainable food in the associative task and the red ramp in the reversal, while the other group was assigned red as correct for the associative and blue for the reversal. In all trials, the position of the feeders was changed randomly to ensure subjects were using colour rather than spatial cues for the association. To avoid the use of chemical cues, we placed the food reward in all three ramps, but in two of them the cricket was covered by small white lids with holes on the top. Lizards were tested once daily between 11 to 12 am, when lizards are active. The training phase lasted 38 days, the Associaive learning task 35, and the Reversal learning task 40 days. We recorded and analysed manually all trials form the learning phases using a standard video player (IINA). PR was the main researcher analysing the data, and was blinded to the lizards' treatment until the end of the analyses. We used as the main variable whether the animal chose the correct ramp first or not. We considered that a choice was made if the head of the lizard was inside the well of one of the ramps. We considered a trial failed if there was no choice in one hour of recording and those trials were considered as 'non data' in the analyses. Here, we analysed the data of the reversal as an index of behavioural flexibility [@brown2010behavioral].  

```{r, fig-Methods}
#| label: fig-Methods
#| fig.cap: "Experimental design of early environment manipulation (**A**) and learning tasks (**B**). Stages 1-3 indicate the different phases of the habituation process. In the associative and reversal tasks, white lids show the ramps where the food reward was not attainable."

knitr::include_graphics("./Others/BEHFLEX_FIG_1.svg")

```

#### Statistical analyses  

We performed the analyses for both species separately. We fitted a total of two different Bayesian multilevel models using the brm function from the brms package (@burkner2017brms) in Quarto (@Allaire_Quarto_2022). We had per each model four parallel chains of 3000 iterations, with a warm up interval of 1000 iterations. We used 'Choice' - whether the individual chose correct (1) or not (0) - as the response variable, and trial, hormone ('CORT' versus 'Control'), incubation temperature ('Cold' versus 'Hot'), and their interaction as fixed factors. Lizard identity was employed as a random intercept, and as a random slope we included the trial within each level of lizard identity. We used the posterior distributions of these models to evaluate differences in learning rate between treatments and species. Learning slopes were obtained using the estimates of the variable trial per each level of the hormone-temperature interaction ('Treatments'); values bigger from zero were considered as evidence of learning, while those less or equal to zero not. We used the pmcmc method to test whether those slopes or the comparissons between treatments (e.g. slope for 'CORT-Cold' lizards minus 'CORT-Hot' lizards) or species were different from zero (two-tailed tests). We considered statistical significance if p-value < 0.05.  
 

## Results

```{r, cleandata}
#| label: cleandata
# Obtain the main df using "./R/1_data_process.R"
source(here("R", "1_data_process.R"))
```

```{r, sampleSize}
#| label: sampleSize
# List with the sample sizes from the database (here("output/databases_clean/data_asso.csv") as the sample size per species and group is the same on each task. We used function sample (see func.R) to estimate the sample size per treatment and species.
source(here("R", "func.R"))
#
specie <- c("delicata", "guichenoti")
hormone <- c("CORT", "Control")
temperature <- c("Cold", "Hot")
#
n_list <- list()
#
for(i in 1:length(specie)){
  for(k in 1:length(hormone)){
    for(l in 1:length(temperature)){
      n_list[[paste(specie[i], hormone[k], temperature[l], sep = "_")]] <- sample(clean_df, specie[i], hormone[k], temperature[l])
      }
    }
  }
```

Originally, we started with 96 lizards, 48 per species and 12 per treatment per species. However, due to natural mortality (n = 11), no completion of the training stage (n = 1), or no motivation during the learning tasks (n = 3; see above), we ended up with a total of 81 lizards. Final sample sizes per treatment and species are disclosed on @tbl-data.

```{r, models}
#| label: models
# Fitting the model and extraction of posteriors for both types of task and species using fit_m function (see func.r in R folder). The result everytime the function is used is a df with the posteriors of the model. The functions saves the model automatically in output/models; and when the parameter refit = FALSE then the posteriors are extracted from the model previously written instead of fitting the model again each time.
source(here("R", "func.R"))
# Model formula: FC_reversal ~ trial_reversal*cort*temp + (1 + trial_reversal|lizard_id)
## A) L. delicata
deli <- fit_m(clean_df, "deli", "complete",  refit = FALSE)
write.csv(deli, file= "./output/Checking/deli.csv")
## B) L. guichenoti
guich <- fit_m(clean_df, "guich", "complete", refit = FALSE)
write.csv(guich, file= "./output/Checking/guich.csv")
```

```{r, resultsRev}
# Rename some of the posteriors and make new estimates for the learning rate for the Reversal task doing the same thing we did in the chunk above.
## 1) L. delicata
deli_CORTCold <- deli$b_trial_reversal
deli_ControlCold <- (deli$'b_trial_reversal:cortControl' + deli$b_trial_reversal)
deli_CORTHot <- (deli$'b_trial_reversal:tempHot' + deli$b_trial_reversal)
deli_ControlHot <- (deli$'b_trial_reversal:cortControl:tempHot' + deli$b_trial_reversal + deli$'b_trial_reversal:cortControl' + deli$'b_trial_reversal:tempHot')
## 2) L. guichenoti
guich_CORTCold <- guich$b_trial_reversal
guich_ControlCold <- (guich$'b_trial_reversal:cortControl' + guich$b_trial_reversal)
guich_CORTHot <- (guich$'b_trial_reversal:tempHot' + guich$b_trial_reversal)
guich_ControlHot <- (guich$'b_trial_reversal:cortControl:tempHot' + guich$b_trial_reversal + guich$'b_trial_reversal:cortControl' + guich$'b_trial_reversal:tempHot')
```

```{r, tbl-data}
#| label: tbl-data
#| tbl-cap: "Estimates of Associative learning slope for all the different treatments per each task, species and group. Mean shows the aritmetic mean of the estimates obtained from the posteriors of the model, and 95% CI indicates the 95% confidence interval of the mean. All p-values were obtained using pmcmc and test the hypothesis that the mean is equal to zero. In bold, those values that are significant (p-value <0.05)"
source(here("R", "func.R"))
#
############################## CREATING BIG DF FOR TABLE ##############################
# Building the vectors for titles of rows and columns
specie <- c("L. delicata", "L. guichenoti")
treatments <- c("CORT-Cold", "Control-Cold", "CORT-Hot", "Control-Hot")
values <- c("Mean", "95% CI", "p-value")
# Building the vectors for estimated means, co.intervals(95%), and p-values for the slopes obtained from posteriors. p-values are obtained using pmcmc function (see func.R), assuming a two-tailed test that testes the hypothesis that the value (slopes in this case) is 0.
#First get estimates for both tasks
estimates <- list(
  deli_CORTCold, deli_ControlCold, deli_CORTHot, deli_ControlHot, 
  guich_CORTCold, guich_ControlCold, guich_CORTHot, guich_ControlHot
)
#
# Then get the mean, co.intervals(95%), and p-values
mean <- format_dec(sapply(estimates, mean), 3)
interval_025 <- format_dec(sapply(estimates, function(x) quantile(x,0.025)), 3)
interval_975 <- format_dec(sapply(estimates, function(x) quantile(x,0.975)), 3)
intervals <- paste(interval_025, interval_975, sep = " , ")
pvalue <- format_dec(sapply(estimates, pmcmc), 4)
#
# Building the df
table_df <- data.frame(
  Specie = rep(specie, each = length(treatments)),
  Treatment = rep(rep(treatments, each = 1), times = length(specie)),
  Mean = rep(mean, each = 1),
  CI = rep(intervals, each = 1),
  PValue = rep(pvalue, each = 1)
)
#
write.csv(table_df, file= "./output/Checking/df.csv")
#
############################## ADDING SAMPLE SIZE TO DF FOR TABLE ##############################
# Make n_list into a df
n_df <- as.data.frame(do.call(rbind, n_list)) %>%
  rename("n" = V1) %>%
  rownames_to_column("model") %>%
  separate(model, into = c("Specie", "cort", "temp"), sep = "_") %>%
  unite("Treatment", c("cort", "temp"), sep = "-") %>%
  mutate(Specie = factor(Specie,
                  labels = c(delicata = "L. delicata", guichenoti = "L. guichenoti")),
        Treatment = factor(Treatment,
                   levels = c("CORT-Cold", "Control-Cold", "CORT-Hot","Control-Hot")))
# Merge both dfs, put sample size together with the treatment, and organize the new df to make it look like the table
new_table_df <- merge(table_df, n_df) %>%
  rename('p-value' = 'PValue', '95% CI' = 'CI') %>% #Change the names of the columns for the table
  select(Specie, Treatment, Mean, `95% CI`, `p-value`, n) %>% #To order the columns in the way I want for the table
  mutate(Specie = factor(Specie,
                  levels = c("L. delicata", "L. guichenoti")),
        Treatment = factor(Treatment, 
                  levels = c("CORT-Cold", "Control-Cold", "CORT-Hot", "Control-Hot")))%>%
  arrange(Specie, Treatment) %>% # To arrange the rows the way I want
  unite("Treatment", c("Treatment", "n"), sep = " (n = ") %>%
  mutate(Treatment = paste0(Treatment, ")"))
write.csv(new_table_df, file= "./output/Checking/new_table_data.csv")
#
############################## MAKING THE TABLE ##############################
## Table format
set_flextable_defaults(
 font.family = "Times New Roman",
 fint.size = 10)
# Split the table_data df by task
real_table <- flextable(new_table_df) %>%
    bold(~ `p-value` < 0.05, ~ `p-value` + Mean + `95% CI`) %>%
    set_table_properties(width = 1) %>%
    align(align="center", part="all") %>% 
    set_header_labels(Mean = "Mean",
                      `95% CI` = "95% CI",
                      `p-value` = "p-value") %>%
    italic(j = 1, italic = TRUE, part = "body") %>% # To have names od species in italics
    flextable::compose(i = c(2:4,6:8), j = 1, value = as_paragraph(""), part = "body") %>% # To remove some of the values in the first column
    hline(i = 4, j = c(1:5), part = "body") %>% # To make some horizontal lines
    autofit() 
real_table
```

We did not find any significant differences between treatments in _L. delicata_ ('Control-Cold' - 'CORT-Cold' = `r format_dec(mean(deli_ControlCold - deli_CORTCold), 3)`, p- value = `r format_dec(pmcmc(deli_ControlCold - deli_CORTCold), 3)`; 'Control-Hot' - 'CORT-Hot' = `r format_dec(mean(deli_ControlHot - deli_CORTHot), 3)`, p- value = `r format_dec(pmcmc(deli_ControlHot - deli_CORTHot), 3)`; 'Control-Hot' - 'Control-Cold' = `r format_dec(mean(deli_ControlHot - deli_ControlCold), 3)`, p-value = `r format_dec(pmcmc(deli_ControlHot - deli_ControlCold), 3)`; 'CORT-Hot' - 'CORT-Cold' = `r format_dec(mean(deli_CORTHot - deli_CORTCold), 3)`, p-value = `r format_dec(pmcmc(deli_CORTHot - deli_CORTCold), 3)`) (see @fig-results) or _L. guichenoti_ ('Control-Cold' - 'CORT-Cold' = `r format_dec(mean(guich_ControlCold - guich_CORTCold), 3)`, p- value = `r format_dec(pmcmc(guich_ControlCold - guich_CORTCold), 3)`; 'Control-Hot' - 'CORT-Hot' = `r format_dec(mean(guich_ControlHot - guich_CORTHot), 3)`, p- value = `r format_dec(pmcmc(guich_ControlHot - guich_CORTHot), 3)`; 'Control-Hot' - 'Control-Cold' = `r format_dec(mean(guich_ControlHot - guich_ControlCold), 3)`, p-value = `r format_dec(pmcmc(guich_ControlHot - guich_ControlCold), 3)`; 'CORT-Hot' - 'CORT-Cold' = `r format_dec(mean(guich_CORTHot - guich_CORTCold), 3)`, p-value = `r format_dec(pmcmc(guich_CORTHot - guich_CORTCold), 3)`) (see @fig-results). When pooled together, we did not find any effect of incubation temperature (_L. delicata_: 'Hot' learning slope - 'Cold' learning slope = `r format_dec(mean((deli_CORTHot + deli_ControlHot) - (deli_CORTCold + deli_ControlCold)),3)`, p-value = `r format_dec(pmcmc((deli_CORTHot + deli_ControlHot) - (deli_CORTCold + deli_ControlCold)),3)`; _L. guichenoti_: 'Hot' learning slope - 'Cold' learning slope = `r format_dec(mean((guich_CORTHot + guich_ControlHot) - (guich_CORTCold + guich_ControlCold)),3)`, p-value = `r format_dec(pmcmc((guich_CORTHot + guich_ControlHot) -(guich_CORTCold + guich_ControlCold)),3)`) or the hormone (_L. delicata_: 'Control' learning slope - 'CORT' learning slope = `r format_dec(mean((deli_ControlCold + deli_ControlHot) - (deli_CORTCold + deli_CORTHot)), 3)`, p-value = `r format_dec(pmcmc((deli_ControlCold + deli_ControlHot) - (deli_CORTCold + deli_CORTHot)), 3)`;_L. guichenoti_: 'Control' learning slope - 'CORT' learning slope = `r format_dec(mean((guich_ControlCold + guich_ControlHot)-(guich_CORTCold + guich_CORTHot)), 3)`, p-value = `r format_dec(pmcmc((guich_ControlCold + guich_ControlHot)-(guich_CORTCold + guich_CORTHot)), 3)`) when groups were pooled. Finally, we did not find any significant differences when we compared the estimated slopes between species for the reversal task (_L. delicata_ - _L. guichenoti_ = `r format_dec(mean((deli_CORTCold + deli_ControlCold + deli_CORTHot + deli_ControlHot) - (guich_CORTCold + guich_ControlCold + guich_CORTHot + guich_ControlHot)), 3)`, p-value = `r format_dec(pmcmc((deli_CORTCold + deli_ControlCold + deli_CORTHot + deli_ControlHot) - (guich_CORTCold + guich_ControlCold + guich_CORTHot + guich_ControlHot)), 3)`). 

```{r, fig-results}
#| label: fig-results
#| fig.cap: "Predicted probability of choosing the correct feeder first over trials. The lines represent the mean predicted probability of choosing the correct feeder first, and the shaded areas represent the standard deviation of the mean; both obtained by using the slope and intercept estimates from the posterior distributions. The different colours represent the different treatments."
source(here("R", "func.R"))
# First step, create the dfs for all models
## 1) L. delicata
df_deli <- df_fig(as.data.frame(deli), "L. delicata")
## 2) L. guichenoti
df_guich <- df_fig(as.data.frame(guich), "L. guichenoti")
#
# Second step, merge the df into a big Fig_df
Fig_df <- rbind(df_deli, df_guich) %>%
  mutate(Trial = gsub("X", "", Trial)) %>%
  mutate(Trial = as.numeric(Trial)) %>%
  group_by(Trial, Treatment, Species) %>%
  summarize(
    Mean_Predicted_prob = mean(Value),
    SE_Predicted_prob = sd(Value)
    ) %>%
  ungroup() %>%
  mutate(
    Treatment = factor(Treatment,
                        levels = c("CORT-Cold", "Control-Cold", "CORT-Hot", "Control-Hot")),
    ) %>%
data.frame()
write.csv(Fig_df, file= "./output/Checking/Fig_df.csv")
# Make the plot
figure_results <- plotting(Fig_df)
ggsave("./output/figures/figure_results.png", plot=figure_results, width = 18, height = 20, units = "cm", dpi = 3000)
knitr::include_graphics("./output/figures/figure_results.png")
```


## Discussion

The study embarked on unraveling the interactive effects of prenatal temperature and Glucocorticoids (GCs) on behavioral flexibility in two closely related species, the delicate skink (_Lampropholis delicata_) and the common garden skink (_L. guichenoti_). Despite sharing life history traits, only _L. delicata_ has proven successful in colonizing various global regions, and we hypothesized this may be related with higher behavioural flexibility. Furthermore, we expected behavioural flexibility in this species to be less susceptible to the effect of early environment since this trait can be adaptive in several stages of invasion that can involve more than one generation. Nevertheless, we did not find any significant differences between treatments or species when we compared their performance in a reversal task. We found that, on average, all the lizards from the four treatments and the two species learned the reversal task - indicated by estimated slopes that are significantly different from cero - and that they learn, on average, at the same rate. Furthermore, these results were consistent when only those individuals that performed better in the previous associative task were included (see Supplementary material).  
Previous studies have shown that _L. delicata_ is more explorative than _L. guichenoti_, which can be advantageous in some facets of the colonization of new environments [@chapple_know_2011]. However, @bezzina2014does found no differences in learning between the two skinks in an associative learning task. Our results are consistent with this study, and suggest that behavioural flexibility does not differ in these species. In addition, we did not find any effect of the treatments on both species. Both results contrast our original predictions, and may indicate that other aspects of their biology are more relevant for _L. delicata_ success as invaders than behavioural flexibility. For instance, the mentioned differences in exploratory behaviour can be the key factor explaining why _L. delicata_ and not _L. guichenoti_ is better at colonising new areas, since exploring more can enhance the ability to effectively locate novel resources in _L. delicata_ [@chapple_know_2011].  
Our early environment manipulation did not affect the performance of the lizards in the task. We expected CORT to decrease reversal learning abilities and high temperatures to minimize these effects. However, our results show no significant differences between treatments in both species. These results contrast with previous studies that show impairments of high GCs levels in different types of learning tests [@lemaire_prenatal_2000; @zhu_prenatal_2004; @farrell_developmental_2015-learn], but align with other experiments where GCs increased or did not impact learning abilities [@szuran_water_1994; @crino_corticosterone_2014-learn; @farrell_developmental_2015-learn; @bebus_associative_2016]. More striking is the absence of effect of incubation temperature, since most of the studies in reptiles reported better performance when incubated at higher temperatures in different associative learning and motor tasks [@amiel_hotter_2012; @amiel_egg_2014; @clark_colour_2014]; and those studies that reported cold-incubated lizards to learn faster [@dayananda_incubation_2017; @abayarathna_effects_2020] used incubation temepratures far beyond the natural range in the hot treatment. It could be arguable whether our results are caused by a low sample size or treatments (especially hormone) are not properly applied, but we find these possibilities unlikely for two main reasons. First, we have seen the effect of the treatments in other traits of the lizards (data non published), and second, both effects are still non significant when the data is pooled. In contrast, we find more plausible that the effects of the early environment can be task-dependent, as some studies show that the effects of prenatal GCs and temeprature vary depending on the region of the brain [@coomber_independent_1997; @sakata_neural_2000; @lemaire_prenatal_2000]. However, this is a speculation that needs to be tested in future studies that examine both the performance in different cognitive tasks as well as the neurophysiological effects.  
In conculsion, our results showed that lizards performed the reversal learning task - as measurement of behavioural flexibility - at a similar level, with no differences between treatments or species. These results contrast our original predictions, and may indicate that other aspects of their biology are more relevant for _L. delicata_ success as invaders than behavioural flexibility and the effects of developmental environment on this trait. However, we cannot discard that the effects of the early environment can be task-dependent, and future studies should examine both the performance in different cognitive tasks as well as the effect of both treatments in the brain.   


## References
<div id="refs"></div>

```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

# Suplementary Material

#### Methods details

###### Husbandry  
*Breeding colony* -- We tested juveniles coming from a breeding colony established in the lab since 2019. There is a total of 270 and 180 adults of *L. delicata* and *L. guichenoti* respectively, housed in big containers (41.5 L x 30.5 W x 21 H cm) with six lizards (2 males and 4 females) per enclosure. Enclosures are provided with non-stick matting, shelter, and several small water dishes. Water is given daily, and they are fed approx. 40 mid-size crickets (*Acheta domestica*) per enclosure three days a week. Crickets are dusted with calcium weekly and multivitamin and calcium biweekly. To ensure a temperature gradient, we employ a heat chord and a heat lamp following a 12 h light:12 h dark cycle. Room temperatures are set to 22-24 Celsius, and warm side of enclosures is usually at 32 Celsius.  
*Eggs collection and incubation* -- Between mid-October 2022 to the end of February 2023, we provided females with a place to lay the eggs by means of small boxes (12.5 L x 8.3 W x 5 H cm) with moist vermiculite inside, that were placed in one extreme of the communal enclosures (see above). We checked for the presence of eggs in the boxes three days a week. After collection, we measured length and width of eggs with a digital caliper to the nearest 0.1 mm and weight them with a (OHAUS, Model spx123) digital scale ± 0.001g error. Then eggs were treated with CORT or vehicle (see CORT and Temperature manipulation below) and were placed in individual cups (80 mL) with moist vermiculite (12 parts water to 4 parts vermiculite). The cups were covered with cling wrap to retain moisture and left in LATWIT 2X5D-R1160 incubators at two different temperatures (see CORT and Temperature manipulation below) until hatching.  
*Hatchlings* -- Eggs in the incubator were checked three times a week for hatchlings. After hatchling, we measured juveniles' SVL and Tail Length (TL) with a rule to the nearest mm and weighted them with a (OHAUS, Model spx123) digital scale ± 0.001g error. We then placed hatchlings in individual enclosures (18.7L x 13.2W x 6.3H cm) and provided them with non-stick matting and a small water dish. During this period, they were sprayed water every day and received 3-6 small *A. domestica* crickets three times a week. All care otherwise follows similar protocols to adults (see above).  
Two weeks before we started the training phase (see below), lizards were moved to the experimental arena for acclimatation. The arenas were individual medium size (41 L x 29.7 W x 22 H cm) plastic containers with a shelter (9 L x 6 W x 1.5 H cm) on one of the extremes and a water dish on the other. These new enclosures were placed in two rooms in 7 different racks associated to 7 different CCTV systems (device model DVR-HP210475) that allowed us to record their behaviour during the experiment (see details below). The number of lizards per species and treatment in each rack was counterbalanced to control for any effect of the room or the position of the lizard in the rack. During acclimatation and all the experiment, lizards were fed with only one cricket per day dusted with calcium and multivitamin (see protocol below), and water was supplied *ad libitum*. We provided a temperature gradient by means of a heat cord and heat lamps in a 12 h light: 12 h dark cycle. The rooms temperature was set to between 22-24 Celsius.  

###### CORT and Temperature manipulation  
To test empirically the effect of early environment we manipulated CORT concentration in eggs and incubated them under one of two temperature regimes ('Cold' -- 23ºC ± 3ºC or 'Hot' -- 30ºC ± 3ºC) in a 2x2 factorial design (@fig-Methods A). We first allocated eggs to one of two different treatments: CORT treatment, where eggs were topically supplied with 5µL of CORT dissolved in 70% Ethanol and 30% DMSO (vehicle) at a final (10 pg CORT/mL) concentration (CORT treatment); and a Control treatment, where eggs received an equal volume of the vehicle. CORT concentration employed in the CORT treatment represents 2 standard deviations above the mean natural concentration obtained in eggs from both species (non-published data). Then, eggs were incubated in one of the two previously mentioned temperature regimes ('Cold' or 'Hot') until hatching. The number of eggs per clutch assigned to each hormone and temperature treatment were counterbalanced in both species.  

###### Learning task
The habituation phase was divided into three stages: in the first stage, the reward, a small, frozen cricket (*A. domestica*) was placed in an opaque petri dish (3D x 1.6H cm) (@fig-Methods B, Stage 1); in the second stage, the petri dish with the cricket was placed on top of the white 3D printed ramps (@fig-Methods B, Stage 2); and in the third stage, the cricket was left inside a well (3D x 1.75H cm) on top of the ramp (Fig. @fig-Methods B, Stage 3). Trials in every stage lasted one hour, begining when the feeding block (petri dish, ramp, or both) was placed inside the enclosure and finished when we took the feeding block away. We recorded whether the cricket had been consumed or not and we considered an stage as completed if the lizards ate the crickets in at least 5 out of 6 trials. This phase lasted 38 days, and only in one case we decided not to use the lizard in the next phases because its behaviour was not consistent.  
In the associative phase, we used three ramps that were identical in shape and size but differ in the colour (Associative task in Fig. @fig-Methods B). As in the last stage of the habituation phase, we placed the cricket inside the wells of the ramps, but then two of them were covered with 3D-printed lids (3D x 0.5H cm) so prey was only accessible in "the correct" ramp. The food reward was placed in all three wells to avoid lizard using prey chemical cues, that were released in the closed wells thanks to a series of small holes on the top of the lids. The colours of the feeders were green, red, and blue, as previous studies demonstrate that squamates can discriminate between these colours [@Baden_Osorio_2019_Vert_vision]. However, we decided to split the lizards in two groups to control for potential colour preference that could bias our results. One group of lizards was assigned the blue ramp as the correct choice (i.e., the ramp with the non-covered frozen cricket) in the associative task and the red ramp in the reversal, while the other group was assigned red as correct for the associative and blue for the reversal. In all trials, the position of the feeders was changed randomly to ensure subjects were using colour rather than spatial cues for the association. Lizards were tested in this task once a day for 35 days. After the colour association phase, we performed a choice reversal task (Reversal task in @fig-Methods B). Here, the attainability of prey was indicated by a different colour from the reversal, requiring the lizards to form a novel association between the new colour and the food reward. This test was done once a day for 40 days.  
We performed the full experiment was between the 6^th^ of March until the 26^th^ of June 2023, between 11 to 12 am, when the lizards were active. Trials in the learning phases (colour associative task and reversal tasks) were recorded with different CCTV systems always using the same camera per individual. Videos were analysed manually using a standard video player (IINA) by PR, who recorded whether the first choice made by each subject was the correct feeder or not. We considered a choice was made if the head of the lizard was inside the well of one of the ramps. We considered a trial failed if there was no choice in one hour of recording and those trials were considered as 'non data' in the analyses. We excluded from our analyses those individuals with more than 15 trials failed (i.e. they did not make a choice), and we considered the first trial to be the first one where the individual made a choice. We also considered individuals to be reinforced if the cricket was eaten after the test independently of whether their initial choice was correct or not.  


```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

#### Checking the models plots  
```{r, residuals}
# Chunk for calling all the models and making the residuals
## L. delicata
mod_deli <- readRDS(here("output/models/delicomplete.rds"))
resid_deli <- residuals(mod_deli)
## L. guichenoti
mod_guich <- readRDS(here("output/models/guichcomplete.rds"))
resid_guich <- residuals(mod_guich)
```

Model formula for the reversal task is:  
Choice  ~ trial_reversal*cort*temp + (1 + trial_reversal|lizard_id)  
Plots for the different models of the associative task:  
1.- _L. delicata_    
```{r , plotmod_drr, out.width="70%", fig.align="center"}
bayes_R2(mod_deli)
plot(mod_deli)
```

```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

2.- _L. guichenoti_  
```{r , plotmod_grr, out.width="70%", fig.align="center"}
bayes_R2(mod_guich)
plot(mod_guich)
```

```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

#### Results employing only those individuals that passed a learning criterion of 80% correct choices in the last 10 trials of the associative task  

```{r, cleandata2}
#| label: cleandata2
# Cleaning the data to select only those individuals that passed a learning criterion of 80% correct choices in the last 10 trials of the associative task.
data <- read.csv(here("data/Learning.csv"))
percentage_per_lizard <- data %>%
  filter(trial_associative > 25 & trial_associative <= 35) %>%
  group_by(lizard_id) %>%
  summarise(percentage = mean(FC_associative == 1))
# Filter lizards where the percentage is at least 80%
filtered_lizards <- percentage_per_lizard %>%
  filter(percentage >= 0.8)
# Subset the original dataset based on the filtered lizard IDs
clean_df_2 <- data %>%
  filter(lizard_id %in% filtered_lizards$lizard_id) %>%
  filter(sum(is.na(FC_reversal)) <= 15) %>%
    mutate(temp = gsub("[AB]_", "", trt),
          cort = gsub("_[2][38]", "", trt))  %>%
    mutate(temp = factor(temp,
      levels = c("23", "28"),
      labels = c("23" = "Cold", "28" = "Hot"))) %>%
    mutate(cort = factor(cort,
      levels = c("B", "A"),
      labels = c("B" = "CORT", "A" = "Control"))) %>%
    mutate(trial_reversal=as.numeric(trial_reversal)) %>%
  data.frame()
```

```{r, sampleSize2}
#| label: sampleSize2
# List with the sample sizes from the database (here("output/databases_clean/data_asso.csv") as the sample size per species and group is the same on each task. We used function sample (see func.R) to estimate the sample size per treatment and species.
source(here("R", "func.R"))
#
specie <- c("delicata", "guichenoti")
hormone <- c("CORT", "Control")
temperature <- c("Cold", "Hot")
#
n_list_2 <- list()
for(i in 1:length(specie)){
  for(k in 1:length(hormone)){
    for(l in 1:length(temperature)){
      n_list_2[[paste(specie[i], hormone[k], temperature[l], sep = "_")]] <- sample(clean_df_2, specie[i], hormone[k], temperature[l])
      }
    }
  }
```

```{r, models2}
#| label: models2
# Fitting the model and extraction of posteriors for both types of task and species using fit_m function (see func.r in R folder). The result everytime the function is used is a df with the posteriors of the model. The functions saves the model automatically in output/models; and when the parameter refit = FALSE then the posteriors are extracted from the model previously written instead of fitting the model again each time.
source(here("R", "func.R"))
# Model formula: FC_reversal ~ trial_reversal*cort*temp + (1 + trial_reversal|lizard_id)
## A) L. delicata
deli_2 <- fit_m(clean_df_2, "deli", "suppl", refit = FALSE)
write.csv(deli_2, file= "./output/Checking/deli.csv")
## B) L. guichenoti
guich_2 <- fit_m(clean_df_2, "guich", "suppl", refit = FALSE)
write.csv(guich_2, file= "./output/Checking/guich.csv")
```

```{r, resultsRev2}
# Rename some of the posteriors and make new estimates for the learning rate for the Reversal task doing the same thing we did in the chunk above.
## 1) L. delicata
deli_CORTCold_2 <- deli_2$b_trial_reversal
deli_ControlCold_2 <- (deli_2$'b_trial_reversal:cortControl' + deli_2$b_trial_reversal)
deli_CORTHot_2 <- (deli_2$'b_trial_reversal:tempHot' + deli_2$b_trial_reversal)
deli_ControlHot_2 <- (deli_2$'b_trial_reversal:cortControl:tempHot' + deli_2$b_trial_reversal + deli_2$'b_trial_reversal:cortControl' + deli_2$'b_trial_reversal:tempHot')
## 2) L. guichenoti
guich_CORTCold_2 <- guich_2$b_trial_reversal
guich_ControlCold_2 <- (guich_2$'b_trial_reversal:cortControl' + guich_2$b_trial_reversal)
guich_CORTHot_2 <- (guich_2$'b_trial_reversal:tempHot' + guich_2$b_trial_reversal)
guich_ControlHot_2 <- (guich_2$'b_trial_reversal:cortControl:tempHot' + guich_2$b_trial_reversal + guich_2$'b_trial_reversal:cortControl' + guich_2$'b_trial_reversal:tempHot')
```

```{r, tbl-data_2}
#| label: tbl-data_2
#| tbl-cap: "Estimates of Associative learning slope for all the different treatments per each task, species and group. Mean shows the aritmetic mean of the estimates obtained from the posteriors of the model, and 95% CI indicates the 95% confidence interval of the mean. All p-values were obtained using pmcmc and test the hypothesis that the mean is equal to zero. In bold, those values that are significant (p-value <0.05)"
source(here("R", "func.R"))
#
############################## CREATING BIG DF FOR TABLE ##############################
# Building the vectors for titles of rows and columns
specie <- c("L. delicata", "L. guichenoti")
treatments <- c("CORT-Cold", "Control-Cold", "CORT-Hot", "Control-Hot")
values <- c("Mean", "95% CI", "p-value")
# Building the vectors for estimated means, co.intervals(95%), and p-values for the slopes obtained from posteriors. p-values are obtained using pmcmc function (see func.R), assuming a two-tailed test that testes the hypothesis that the value (slopes in this case) is 0.
#First get estimates for both tasks
estimates_2 <- list(
  deli_CORTCold_2, deli_ControlCold_2, deli_CORTHot_2, deli_ControlHot_2, 
  guich_CORTCold_2, guich_ControlCold_2, guich_CORTHot_2, guich_ControlHot_2
)
#
# Then get the mean, co.intervals(95%), and p-values
mean_2 <- format_dec(sapply(estimates_2, mean), 3)
interval_025_2 <- format_dec(sapply(estimates_2, function(x) quantile(x,0.025)), 3)
interval_975_2 <- format_dec(sapply(estimates_2, function(x) quantile(x,0.975)), 3)
intervals_2 <- paste(interval_025_2, interval_975_2, sep = " , ")
pvalue_2 <- format_dec(sapply(estimates_2, pmcmc), 4)
#
# Building the df
table_df_2 <- data.frame(
  Specie = rep(specie, each = length(treatments)),
  Treatment = rep(rep(treatments, each = 1), times = length(specie)),
  Mean = rep(mean_2, each = 1),
  CI = rep(intervals_2, each = 1),
  PValue = rep(pvalue_2, each = 1)
)
#
write.csv(table_df, file= "./output/Checking/df.csv")
#
############################## ADDING SAMPLE SIZE TO DF FOR TABLE ##############################
# Make n_list into a df
n_df_2 <- as.data.frame(do.call(rbind, n_list_2)) %>%
  rename("n" = V1) %>%
  rownames_to_column("model") %>%
  separate(model, into = c("Specie", "cort", "temp"), sep = "_") %>%
  unite("Treatment", c("cort", "temp"), sep = "-") %>%
  mutate(Specie = factor(Specie,
                  labels = c(delicata = "L. delicata", guichenoti = "L. guichenoti")),
        Treatment = factor(Treatment,
                   levels = c("CORT-Cold", "Control-Cold", "CORT-Hot","Control-Hot")))
# Merge both dfs, put sample size together with the treatment, and organize the new df to make it look like the table
new_table_df_2 <- merge(table_df_2, n_df_2) %>%
  rename('p-value' = 'PValue', '95% CI' = 'CI') %>% #Change the names of the columns for the table
  select(Specie, Treatment, Mean, `95% CI`, `p-value`, n) %>% #To order the columns in the way I want for the table
  mutate(Specie = factor(Specie,
                  levels = c("L. delicata", "L. guichenoti")),
        Treatment = factor(Treatment, 
                  levels = c("CORT-Cold", "Control-Cold", "CORT-Hot", "Control-Hot")))%>%
  arrange(Specie, Treatment) %>% # To arrange the rows the way I want
  unite("Treatment", c("Treatment", "n"), sep = " (n = ") %>%
  mutate(Treatment = paste0(Treatment, ")"))
write.csv(new_table_df, file= "./output/Checking/new_table_data.csv")
#
############################## MAKING THE TABLE ##############################
## Table format
set_flextable_defaults(
 font.family = "Times New Roman",
 fint.size = 10)
# Split the table_data df by task
real_table_2 <- flextable(new_table_df_2) %>%
    bold(~ `p-value` < 0.05, ~ `p-value` + Mean + `95% CI`) %>%
    set_table_properties(width = 1) %>%
    align(align="center", part="all") %>% 
    set_header_labels(Mean = "Mean",
                      `95% CI` = "95% CI",
                      `p-value` = "p-value") %>%
    italic(j = 1, italic = TRUE, part = "body") %>% # To have names od species in italics
    flextable::compose(i = c(2:4,6:8), j = 1, value = as_paragraph(""), part = "body") %>% # To remove some of the values in the first column
    hline(i = 4, j = c(1:5), part = "body") %>% # To make some horizontal lines
    autofit() 
real_table_2
```